# راه‌اندازی پایگاه داده

این پروژه از یک پایگاه داده SQLite برای ذخیره‌سازی اطلاعات کتاب‌ها استفاده می‌کند.

## ✅ Migration کامل انجام شد!

**پایگاه داده جدید با موفقیت جایگزین داده‌های ثابت شده است.**

### کامپوننت‌های به‌روزرسانی شده:

- ✅ **RecommendationsSection**: از API برای دریافت کتاب‌ها استفاده می‌کند
- ✅ **CategoryStatsCard**: آمار دسته‌بندی‌ها را از API دریافت می‌کند  
- ✅ **BookRowsSection**: از API برای نمایش ردیف‌های کتاب استفاده می‌کند
- ✅ **HomePage**: جستجو و نمایش از طریق API انجام می‌شود
- ✅ **BookDetailPage**: جزئیات کتاب از API دریافت می‌شود
- ✅ **تمام API routes**: با پایگاه داده SQLite متصل شده‌اند

## تبدیل CSV به پایگاه داده

### گام 1: تبدیل فایل CSV
```bash
npm run migrate
```

این دستور:
- فایل `src/data/books.csv` را خوانده
- پایگاه داده SQLite (`books.db`) ایجاد می‌کند
- تمام جداول مورد نیاز را ایجاد می‌کند
- داده‌های CSV را به پایگاه داده منتقل می‌کند
- فیلدهای اضافی مانند قیمت، امتیاز، و محبوبیت تولید می‌کند

### گام 1.5: به‌روزرسانی قیمت‌ها به تومان (اختیاری)
```bash
npm run update-prices
```

این دستور:
- قیمت‌های کتاب‌ها را از دلار به تومان تبدیل می‌کند
- قیمت‌های واقعی بر اساس ژانر، زبان، سال انتشار و ویژگی‌های کتاب تعیین می‌کند
- محدوده قیمت‌ها: 120,000 تا 500,000 تومان

### گام 2: راه‌اندازی سرور
```bash
npm run dev
```

## ساختار پایگاه داده

### جداول اصلی:
- **books**: اطلاعات اصلی کتاب‌ها
- **categories**: دسته‌بندی‌های مختلف
- **tags**: برچسب‌های کتاب‌ها
- **awards**: جوایز کتاب‌ها

### جداول رابطه:
- **book_categories**: رابطه many-to-many بین کتاب‌ها و دسته‌بندی‌ها
- **book_tags**: رابطه many-to-many بین کتاب‌ها و برچسب‌ها
- **book_awards**: رابطه many-to-many بین کتاب‌ها و جوایز

## API های موجود

### دریافت کتاب‌ها
```
GET /api/books                    # دریافت تمام کتاب‌ها
GET /api/books?id=1              # دریافت کتاب خاص
GET /api/books?search=شازده      # جستجوی متنی
GET /api/books?genre=رمان        # فیلتر ژانر
GET /api/books?category=bestsellers # فیلتر دسته‌بندی
GET /api/books?page=1&limit=10   # صفحه‌بندی
```

### دریافت دسته‌بندی‌ها
```
GET /api/categories              # دریافت دسته‌بندی‌ها
```

### دریافت ژانرها
```
GET /api/genres                  # دریافت ژانرها
```

## نحوه استفاده در کد

### Client-side (کامپوننت‌های React):
```typescript
// استفاده از API calls
const response = await fetch('/api/books?category=bestsellers');
const data = await response.json();
const books = data.books;
```

### Server-side (API routes):
```typescript
import { BookService } from '@/lib/book-service';

const bookService = BookService.getInstance();

// دریافت تمام کتاب‌ها
const books = await bookService.getAllBooks();

// جستجو در کتاب‌ها
const result = await bookService.searchBooks('شازده', undefined, undefined, 1, 12);

// دریافت کتاب خاص
const book = await bookService.getBookById('1');

// دریافت کتاب‌های یک دسته‌بندی
const categoryBooks = await bookService.getBooksByCategory('bestsellers');
```

## فیلدهای تولید شده خودکار

پس از تبدیل CSV، فیلدهای زیر به صورت خودکار تولید می‌شوند:
- **price**: قیمت واقعی بر اساس ژانر، زبان و ویژگی‌های کتاب (120,000 تا 500,000 تومان)
- **rating**: امتیاز تصادفی بین 3.0-5.0
- **review_count**: تعداد نظرات تصادفی بین 10-510
- **popularity**: محبوبیت تصادفی بین 1-100
- **sales_rank**: رتبه فروش تصادفی بین 1-1000
- **cover_image**: URL تصویر جلد (placeholder)
- **is_hot**: بر اساس محبوبیت >= 80
- **is_new**: بر اساس سال انتشار >= 2010

### فاکتورهای تأثیرگذار بر قیمت:
- **ژانر**: رمان‌ها و رئالیسم جادویی گران‌تر، کتاب‌های کودک ارزان‌تر
- **زبان**: کتاب‌های ترجمه‌ای 20% گران‌تر از کتاب‌های فارسی
- **سال انتشار**: کتاب‌های جدید (2020+) 15% گران‌تر، قدیمی‌ها (1990-) 10% ارزان‌تر
- **تعداد صفحات**: کتاب‌های ضخیم (500+ صفحه) 20% گران‌تر، نازک (<150 صفحه) 15% ارزان‌تر
- **محبوبیت**: کتاب‌های محبوب 10% گران‌تر
- **امتیاز**: کتاب‌های با امتیاز بالا (4.5+) 5% گران‌تر
- **ناشر**: ناشران معتبر 10% گران‌تر

## دسته‌بندی‌های خودکار

کتاب‌ها بر اساس ویژگی‌هایشان به دسته‌بندی‌های زیر تعلق می‌گیرند:
- **hot-books**: کتاب‌های پرطرفدار
- **bestsellers**: پرفروش‌ترین‌ها
- **new-releases**: انتشارات جدید
- **best-children-books**: بهترین کتاب‌های کودک
- **le-monde-100**: کلاسیک‌های قدیمی
- **century-21-top-100**: بهترین‌های قرن 21
- **man-booker**: کتاب‌های با امتیاز بالا
- **houshang-golshiri**: ادبیات فارسی

## برچسب‌های خودکار

برچسب‌ها بر اساس ژانر و محتوای کتاب تولید می‌شوند:
- برچسب‌های ژانری (رمان، شعر، داستان)
- برچسب‌های زبانی (ترجمه، ادبیات فارسی)
- برچسب‌های دوره‌ای (کلاسیک، معاصر)

## مزایای Migration به پایگاه داده

### عملکرد بهتر:
- ✅ جستجوی سریع‌تر با ایندکس‌های بهینه
- ✅ فیلتر و مرتب‌سازی کارآمد
- ✅ صفحه‌بندی پیشرفته

### مقیاس‌پذیری:
- ✅ امکان افزودن کتاب‌های جدید بدون restart
- ✅ مدیریت حجم زیاد داده‌ها
- ✅ کش کردن خودکار queries

### انعطاف‌پذیری:
- ✅ جستجوی پیچیده در چندین فیلد
- ✅ ترکیب فیلترهای مختلف
- ✅ گروه‌بندی و تجمیع داده‌ها

### نگهداری آسان‌تر:
- ✅ تفکیک منطق business از presentation
- ✅ API های RESTful استاندارد
- ✅ Type safety کامل با TypeScript 